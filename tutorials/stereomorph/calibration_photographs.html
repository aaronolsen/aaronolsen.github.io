<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<title>StereoMorph - Calibrating stereo cameras</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<link rel="shortcut icon" href="../../img/favicon.png"/>
<link href="../../css/stylesheet2.css" rel="stylesheet" type="text/css">

<body>
	<div id='container' class='container'>

		<div id='header' class='header' >
			<div style='position:relative;' >
				<img id='header_image' style='float:right;' src='../../img/headers/American Wigeon.jpg' />
				<div id='header_image_caption' style='color:white' class='header_image_caption' >
					American Wigeon
				</div>
			</div>
		</div>

		<div id='linksidebar' class='linksidebar' >
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../about_me.html'>About me</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../current_projects.html'>Current projects</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../software.html'>Software</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../tutorials/visualization3d.html'>Tutorials</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/visualization3d.html'>3D Visualization</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/morphometrics.html'>Shape analysis</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/mechanisms.html'>Mechanism models</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph.html'>StereoMorph User Guide</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/installing_stereomorph.html'>1 Getting started</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/choosing_cameras_general.html'>2 Choosing cameras</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/choose_checkerboard_size.html'>3 Creating a checkerboard</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/arranging_cameras_photography.html'>4 Arranging the cameras</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_general.html'>5 Calibrating stereo cameras</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_general.html'>5.1 General calibration steps and parameters</a>
			</div>
				<div class='linksidebar_sub3link_u' >
				<a class='linksidebar_link_u' href='../../tutorials/stereomorph/calibration_photographs.html'>5.2 Calibrating with photographs</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_video.html'>5.3 Calibrating with video</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_coefficients.html'>5.4 Calculating calibration coefficients</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_accuracy.html'>5.5 Determining calibration accuracy</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/photographing_objects.html'>6 Photographing objects</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/digitizing_video.html'>7 Digitizing application</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/reconstructing_landmarks.html'>8 Reconstruction</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/visualizing_shape.html'>9 Visualizing shape data</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/reflect_missing.html'>10 Reflecting bilateral landmarks</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/align_bilateral.html'>11 Aligning bilateral landmarks</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/extracting_frames.html'>12 Additional features</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/citing.html'>13 Citing StereoMorph</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/acknowledgements.html'>14 Acknowledgements</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/knex/large_u_joint.html'>K'nex models</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../contact.html'>Contact</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../cv.html'>CV</a>
			</div>
		</div>

		<div id='maincontent' class='maincontent' >

			<div id='pagetrail' class='pagetrail' ><a href="../../about_me.html">home</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;<a href="../../tutorials/visualization3d.html">tutorials</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;<a href="../../tutorials/stereomorph.html">stereomorph user guide</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;<a href="../../tutorials/stereomorph/calibration_general.html">5 calibrating stereo cameras</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;5.2 calibrating with photographs</div>


<div class="maincontentfill">
	<h1>5.2 Calibrating with photographs</h1>
	<p>
		The following will show you how to call <span class='in_line_code'>calibrateCameras()</span> using a set of photographs 
		from two or more camera views.
	</p>
	<p>
		1. Take 8-10 photographs from each camera of the checkerboard at different positions 
		and angles within the calibration space.
	</p>

	<img width='500px' class='center' src='../../img/tutorials/stereomorph/calibration_images.jpg' />
	<div class='img_caption' >
		Four photographs of a checkerboard from two views at different positions and angles 
		within the calibration space.
	</div>

	<p>
		2. Upload the calibration images into a folder, separating the images from different 
		views into two different folders (e.g. "Left" and "Right", "View 1" 
		and "View 2"). Note that if you are also photographing objects and you're 
		transferring images via a camera memory card it's best to wait until you've taken 
		all the photographs before upload the calibration images - taking the memory card 
		out of the camera risks moving the cameras in which case they'll no longer be properly 
		calibrated. If you are using a cord to upload the images then you can upload the 
		calibration images, check the calibration and proceed with photographing your objects.
	</p>
	<p>
		If you'd like to work through the example below, you can 
		<a href='../../software/stereomorph/tutorial_files/Calibrate_images.zip' target='_blank'>
		download an example set of calibration images here (5 MB)</a>. Unzip this folder 
		and move it to your R working directory.
	</p>
	<p>
		3. Call the <span class='in_line_code'>calibrateCameras()</span> function. The call for the set of example images looks 
		like this:
	</p>

<div class="code" ><pre class="code">
<span class="code_comment" ># Calibrate cameras from photographs</span>
<span class="code_function" >calibrateCameras</span>(img.dir=<span class="code_quote" >'Calibrate_images'</span>, sq.size=<span class="code_quote" >'6.35 mm'</span>, nx=<span class="code_numeric" >8</span>, ny=<span class="code_numeric" >6</span>, 
     cal.file=<span class="code_quote" >'calibration.txt'</span>, corner.dir=<span class="code_quote" >'Corners'</span>, verify.dir=<span class="code_quote" >'Verify'</span>,
     error.dir=<span class="code_quote" >'Errors'</span>)
</pre></div>

	<p>
		The function will begin by trying to detect the corners in all of the calibration 
		images. You can see the detected corners by looking in the "Verify" folder.
	</p>

	<img width='500px' class='center' src='../../img/tutorials/stereomorph/detected_corners.jpg' />
	<div class='img_caption' >
		Verify image to check the order of the detected corners. The red circle indicates 
		the first corner and the blue circle indicates the last corner.
	</div>

	<p>
		The corners are returned in a particular order and this order is important for the 
		calibration to work properly. In the verify image the first corner will be indicated 
		by a red circle and the last by a blue circle. A green line connects these two 
		circles showing how the corners are ordered between the first and the last (think RGB).
	</p>
	<p>
		The corner detection will always return the corners ordered along the <span class='in_line_code'>nx</span> 
		direction first and the <span class='in_line_code'>ny</span> direction second. However, the identified 
		"first" corner (red circle) may not be same corner across all the images 
		if the checkerboards are in very different orientations (especially if one is 
		upside down relative to the other). Be sure to <strong>look through the verify 
		images and check that the function is detecting the corners in the same order for 
		all of the calibration images</strong> (including across both views).
	</p>
	<p>
		If your cameras are arranged such that one view is upside-down relative to the other, 
		set the <span class='in_line_code'>flip.view</span> parameter to TRUE in the <span class='in_line_code'>calibrateCameras()</span> call, as shown 
		below. Note that if you set <span class='in_line_code'>flip.view</span> to TRUE and use the example calibration 
		images linked above, the calibration will not work since the corner order will not 
		be consistent between the two views.
	</p>

<div class="code" ><pre class="code">
<span class="code_comment" ># Calibrate cameras from photographs when one view is 'upside-down'</span>
<span class="code_function" >calibrateCameras</span>(img.dir=<span class="code_quote" >'Calibrate_images'</span>, sq.size=<span class="code_quote" >'6.35 mm'</span>, nx=<span class="code_numeric" >8</span>, ny=<span class="code_numeric" >6</span>, 
     flip.view=TRUE, cal.file=<span class="code_quote" >'calibration.txt'</span>, corner.dir=<span class="code_quote" >'Corners'</span>,
     verify.dir=<span class="code_quote" >'Verify'</span>, error.dir=<span class="code_quote" >'Errors'</span>)
</pre></div>

	<p>
		For the example set, the corners are detected in all the images. However, this is 
		unusual. Usually, the detection will fail for a few images due to poor lighting or 
		if portion of the checkerboard is cut off. These images will simply be ignored. 
		It's a good idea to take at least 10 calibration images, so that if a couple images 
		fail you will still have enough to get a good calibration.
	</p>

	<div class='tutorial_previous_next' >
		<div style="float:left"><strong>Previous:</strong> <a href="calibration_general.html" >General calibration steps and parameters</a></div>
		<div style="float:right"><strong>Next:</strong> <a href="calibration_video.html" >Calibrating with video</a></div>
	</div>
</div>
		</div>

		<div id='footer' class='footer' >
			<div style='float:left;' >© 2018 Aaron Olsen. All rights reserved.<br><br></div>
			<div style='float:right;' >Design and photographs by Aaron Olsen.</div>
			<div style='float:left;background-color:;' >The material on this site is based upon work supported by the National Science Foundation (DGE-1144082, DGE-0903637, DBI-1612230). Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.</div>
		</div>

	</div>

</body>
<script src="../../js/sharedfunctions2.js" type="text/javascript" ></script>