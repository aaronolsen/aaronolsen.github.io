<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<title>StereoMorph - Calibrating stereo cameras</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
<link rel="shortcut icon" href="../../img/favicon.png"/>
<link href="../../css/stylesheet2.css" rel="stylesheet" type="text/css">

<body>
	<div id='container' class='container'>

		<div id='header' class='header' >
			<div style='position:relative;' >
				<img id='header_image' style='float:right;' src='../../img/headers/American Wigeon.jpg' />
				<div id='header_image_caption' style='color:white' class='header_image_caption' >
					American Wigeon
				</div>
			</div>
		</div>

		<div id='linksidebar' class='linksidebar' >
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../about_me.html'>About me</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../current_projects.html'>Current projects</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../software.html'>Software</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../tutorials/visualization3d.html'>Tutorials</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/visualization3d.html'>3D Visualization</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/morphometrics.html'>Shape analysis</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/mechanisms.html'>Mechanism models</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph.html'>StereoMorph User Guide</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/installing_stereomorph.html'>1 Getting started</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/choosing_cameras_general.html'>2 Choosing cameras</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/choose_checkerboard_size.html'>3 Creating a checkerboard</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/arranging_cameras_photography.html'>4 Arranging the cameras</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_general.html'>5 Calibrating stereo cameras</a>
			</div>
				<div class='linksidebar_sub3link_u' >
				<a class='linksidebar_link_u' href='../../tutorials/stereomorph/calibration_general.html'>5.1 General calibration steps and parameters</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_photographs.html'>5.2 Calibrating with photographs</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_video.html'>5.3 Calibrating with video</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_coefficients.html'>5.4 Calculating calibration coefficients</a>
			</div>
				<div class='linksidebar_sub3link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/calibration_accuracy.html'>5.5 Determining calibration accuracy</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/photographing_objects.html'>6 Photographing objects</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/digitizing_video.html'>7 Digitizing application</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/reconstructing_landmarks.html'>8 Reconstruction</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/visualizing_shape.html'>9 Visualizing shape data</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/reflect_missing.html'>10 Reflecting bilateral landmarks</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/align_bilateral.html'>11 Aligning bilateral landmarks</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/extracting_frames.html'>12 Additional features</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/citing.html'>13 Citing StereoMorph</a>
			</div>
			<div class='linksidebar_sub2link' >
				<a class='linksidebar_link' href='../../tutorials/stereomorph/acknowledgements.html'>14 Acknowledgements</a>
			</div>
			<div class='linksidebar_sublink' >
				<a class='linksidebar_link' href='../../tutorials/knex/large_u_joint.html'>K'nex models</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../contact.html'>Contact</a>
			</div>
			<div class='linksidebar_mainlink' >
				<a class='linksidebar_link' href='../../cv.html'>CV</a>
			</div>
		</div>

		<div id='maincontent' class='maincontent' >

			<div id='pagetrail' class='pagetrail' ><a href="../../about_me.html">home</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;<a href="../../tutorials/visualization3d.html">tutorials</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;<a href="../../tutorials/stereomorph.html">stereomorph user guide</a>&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;5 calibrating stereo cameras&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;&nbsp;5.1 general calibration steps and parameters</div>


<div class="maincontentfill">
	<h1>5.1 General calibration steps and parameters</h1>
	<p>
		In order to perform stereo camera reconstruction we need a mathematical formula or 
		model that relates particular combinations of 2D pixel coordinates from each view 
		to 3D coordinates. The mathematical model used by StereoMorph is the DLT model 
		<a href='https://en.wikipedia.org/wiki/Direct_linear_transformation' target='_blank'>direct 
		linear transformation</a>; Abdel-Aziz & Karara 1971). With the DLT method, each 
		calibrated camera has a set of 11 coefficients that relate each unique 3D coordinate 
		in the calibration space to their corresponding (non-unique) 2D pixel coordinates 
		in that particular camera view; modified forms of DLT use additional coefficients 
		to account for lens distortion but StereoMorph uses just 11.
	</p>
	<p>
		Note that if you only have the coefficients for a single camera view you can only 
		go one way: you can only project 3D points to pixel coordinates, not the other way 
		around. This is because a point with particular pixel coordinates in an image can 
		fall anywhere along a line in 3D space. But if you have the DLT coefficients from 
		two or more camera views you can combine the pixel coordinates of a single point 
		in both views from multiple camera views to find the corresponding 3D coordinate. 
		You can think of this as finding the intersection of the two lines from each camera 
		view in 3D space. Thus, the objective of the camera calibration step is to 
		determine these 11 DLT coefficients for each camera.
	</p>
	<p>
		Just as there are multiple mathematical models for 3D reconstruction there are also 
		multiple methods with which to determine the DLT coefficients. Typically, DLT 
		coefficients are determined using what's referred to as a calibration or reference 
		object. This is usually a 3D, cube-shaped structure filled with markers having 
		known 3D positions relative to one another. The markers are digitized in each 
		camera and the set of corresponding 2D and 3D coordinates are used to calculate 
		the DLT coefficients.
	</p>
	<p>
		Because of the difficulties in designing and building a 3D calibration, and the 
		time-consuming task of digitizing the calibration cube markers, StereoMorph 
		determines the DLT coefficients using the internal corners automatically detected 
		from a checkerboard pattern. A checkerboard is photographed from both camera views 
		at different positions and angles within the calibration space. Rather than 
		estimate the DLT coefficients directly, StereoMorph estimates the six transformation 
		parameters (3 translation, 3 rotation) required to transform the first checkerboard 
		into each subsequent checkerboard in 3D space by minimizing the reconstruction 
		error. These transformation parameters are then used to generate 3D coordinates 
		(the equivalent of a calibration object) and calculate the DLT coefficients.
	</p>
	<p>
		Whether you are using stereo photographs or video, be sure that you position the 
		checkerboard at <strong>different positions and angles throughout the calibration 
		space</strong>. This provides a sampling of points throughout the 
		space for the calibration. If you only photograph the checkerboard in one area of 
		the calibration volume, reconstruction errors could be relatively higher in other 
		areas. Similarly, if you only photograph the checkerboard at a particular angle 
		(e.g. 45 degrees), you won't have good sampling of points along each dimension of 
		the space (since a checkerboard is a flat surface it can only sample two dimensions 
		at any one time). This can causes reconstruction errors to be higher along 
		particular dimensions than along others.
	</p>

	<p>
		Calibration in StereoMorph is accomplished using a single function, <span class='in_line_code'>calibrateCameras()</span>. 
		As of version 1.6, this function works with both photographs and synchronized video. 
		While the parameters will differ depending on the camera arrangement and the type 
		of input (i.e. photograph versus video), <span class='in_line_code'>calibrateCameras()</span> follows four general steps:
	</p>
	<ol>
		<li>
			<strong>Detect checkerboard corners</strong>: The function will try to find the specified 
			number of checkerboard corners in each input image.
		</li>
		<li>
			<strong>Estimate undistortion coefficients</strong>: (Optional) If specified, the 
			function will solve for coefficients that minimize standard lens distortion. 
			This will not undistort the original photographs or video. But these coefficients 
			will be used in the calibration and reconstruction process to minimize error 
			due to lens distortion.
		</li>
		<li>
			<strong>Estimate DLT coefficients</strong>: The function will estimate a set of optimized 
			DLT coefficients that can be used to reconstruct points and curves from each 
			view into 3D.
		</li>
		<li>
			<strong>Estimate calibration accuracy</strong>: The function will estimate the calibration, 
			using a separate set of images within the calibration set (if a sufficient 
			number of images are supplied).
		</li>
	</ol>

	<p>
		Because steps 1-3 are fairly time-consuming, the function will save the results of 
		these steps. If you decide you would like to re-run any of these steps you can simply 
		call <span class='in_line_code'>calibrateCameras()</span> again. Before running each of these three steps, you will 
		be prompted whether you would like to keep the results from the previous run or 
		re-run the step.
	</p>
	<p>
		The <span class='in_line_code'>calibrateCameras()</span> function also has a general set of parameters used for both 
		stereo photography and videography.
	</p>

	<ul>
		<li><strong>img.dir</strong>: A folder containing the calibration images or videos.</li>
		<li><strong>sq.size</strong>: The size of one checkerboard square (length along any one side) 
		including the units (e.g. mm).</li>
		<li><strong>nx</strong>: The number of internal corners along one dimension.</li>
		<li><strong>ny</strong>: The number of internal corners along the other dimension (the choice 
		of which is <strong>nx</strong> and <strong>ny</strong> is arbitrary but must be consistent throughout).</li>
		<li><strong>cal.file</strong>: A file where the calibration results will be saved (the file 
		will automatically be created if one doesn't already exist).</li>
		<li><strong>corner.dir</strong>: A folder where the corners will be saved (the folder will 
		be automatically be created if one doesn't already exist).</li>
		<li><strong>verify.dir</strong>: (Optional) A folder where images will be saved that show 
		the detected corners (the folder will be automatically be created if one doesn't 
		already exist).</li>
		<li><strong>error.dir</strong>: (Optional) A folder where several error diagnostic plots 
		will be saved (the folder will be automatically be created if one doesn't already 
		exist).</li>
		<li><strong>undistort</strong>: A logical (TRUE or FALSE) indicating whether undistortion 
		coefficients should be estimated. Currently, this is only recommended for video 
		input.</li>
	</ul>

	<p>
		The following sections will show how to call <span class='in_line_code'>calibrateCameras()</span> using photographs 
		and video. Before proceeding, make sure the StereoMorph library is loaded into the 
		current R session.
	</p>

<div class="code" ><pre class="code">
<span class="code_comment" ># Load the StereoMorph package</span>
<span class="code_function" >library</span>(StereoMorph)
</pre></div>

	<div class='tutorial_previous_next' >
		<div style="float:left"><strong>Previous:</strong> <a href="arranging_cameras_photography.html" >Arranging cameras for stereo photography</a></div>
		<div style="float:right"><strong>Next:</strong> <a href="calibration_photographs.html" >Calibrating with photographs</a></div>
	</div>
</div>
		</div>

		<div id='footer' class='footer' >
			<div style='float:left;' >© 2017 Aaron Olsen. All rights reserved.<br><br></div>
			<div style='float:right;' >Design and photographs by Aaron Olsen.</div>
			<div style='float:left;background-color:;' >The material on this site is based upon work supported by the National Science Foundation (DGE-1144082, DGE-0903637, DBI-1612230). Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.</div>
		</div>

	</div>

</body>
<script src="../../js/sharedfunctions2.js" type="text/javascript" ></script>